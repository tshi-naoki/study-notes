è¿™ä¸ªæ¨¡å¼çœŸçš„ä¸æ˜¯å¾ˆæ‡‚ï¼Œåªæ˜¯äº†è§£åˆ°è¿™ä¸ªå…¶å®å’Œæ•°å­¦é‡Œé¢çš„ç»„åˆå·®ä¸å¤šï¼Œå°±æ˜¯ä»å¤´èµ°åˆ°å°¾ï¼Œå¾ˆå¤šèŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæœ‰ä¸åŒçš„é€‰æ‹©æ–¹å¼ï¼Œé€šè¿‡å°†ä¸åŒçš„é€‰æ‹©æŒ‚åˆ°æ ‘èŠ‚ç‚¹ä¸Šï¼Œç„¶åè¿›è¡Œåˆ¤å®šèµ°æµç¨‹ã€‚

# ä»‹ç»

ç»„åˆæ¨¡å¼æ˜¯å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ï¼Œç»„åˆæ¨¡å¼ä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚

![](images/Snipaste_2020-10-22_23-39-38.png)

æ ‘å°±æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œç»„åˆæ¨¡å¼å°±æ˜¯å°†è¿™ç§æ•°æ®ç»“æ„ç”¨åˆ°ç±»çš„ç»„åˆä¸Šã€‚

# ä»£ç å®ç°

```java
public abstract class Component {
	protected String name;
	
	public Component(String name) {
		super();
		this.name = name;
	}
	
	public abstract void add(Component component);
	public abstract void removeChildren(Component component);
	public abstract void show(int depth);
	
}
```

```java

import java.util.ArrayList;
import java.util.List;
 
public class Composite extends Component {
 
	private List<Component> children=new ArrayList<>();
	
	public Composite(String name) {
		super(name);
		// TODO Auto-generated constructor stub
	}
 
	@Override
	public void add(Component component) {
		// TODO Auto-generated method stub
		children.add(component);
	}
 
	@Override
	public void removeChildren(Component component) {
		// TODO Auto-generated method stub
		children.remove(component);
	}
 
	@Override
	public void show(int depth) {
		// TODO Auto-generated method stub
		for(int i=0;i<depth;i++)
			System.out.print("-");
		System.out.println("Composite: " + name);
		for(Component component:children) {
			component.show(depth+1);
		}
	}
 
}
```

```java

public class Leaf extends Component {
 
	public Leaf(String name) {
		super(name);
		// TODO Auto-generated constructor stub
	}
 
	@Override
	public void add(Component component) {
		// TODO Auto-generated method stub
		System.out.println("å¶å­ç»“ç‚¹ä¸èƒ½å¢åŠ å­èŠ‚ç‚¹");
	}
 
	@Override
	public void removeChildren(Component component) {
		// TODO Auto-generated method stub
		System.out.println("å¶å­ç»“ç‚¹æ— å­èŠ‚ç‚¹");
	}
 
	@Override
	public void show(int depth) {
		// TODO Auto-generated method stub
		for(int i=0;i<depth;i++)
			System.out.print("-");
		System.out.println("Leaf: " + name);
	}
}
```

```java
public class Client {
 
	public static void main(String[] args) {
		// TODO Auto-generated method stub
		Component root=new Composite("root");
		Component leftchild=new Composite("left child");
		Component rightchild=new Composite("right child");
		root.add(leftchild);root.add(rightchild);
		Component leafA=new Leaf("leaf A");
		Component leafB=new Leaf("leaf B");
		leftchild.add(leafA);  leftchild.add(leafB);
		root.show(1);
		System.out.println();
		leftchild.removeChildren(leafB);  root.removeChildren(rightchild);
		root.show(1);
	}
}
```

# é€æ˜æ–¹å¼ä¸å®‰å…¨æ–¹å¼ï¼š

![](images/Snipaste_2020-10-22_23-44-16.png)

# è¯»å–çš„å¦ä¸€ç¯‡åšæ–‡

# ç»„åˆæ¨¡å¼çš„ä»‹ç»

![](images/Snipaste_2020-10-22_23-47-22.png)

ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°è¿™æœ‰ç‚¹åƒèºä¸ğŸ”©å’Œèºæ¯ï¼Œé€šè¿‡ä¸€å †çš„é“¾æ¥ç»„ç»‡å‡ºä¸€æ£µç»“æ„æ ‘ã€‚è€Œè¿™ç§é€šè¿‡æŠŠç›¸ä¼¼å¯¹è±¡(ä¹Ÿå¯ä»¥ç§°ä½œæ˜¯æ–¹æ³•)ç»„åˆæˆä¸€ç»„å¯è¢«è°ƒç”¨çš„ç»“æ„æ ‘å¯¹è±¡çš„è®¾è®¡æ€è·¯å«åšç»„åˆæ¨¡å¼ã€‚

è¿™ç§è®¾è®¡æ–¹å¼å¯ä»¥è®©ä½ çš„æœåŠ¡ç»„èŠ‚ç‚¹è¿›è¡Œè‡ªç”±ç»„åˆå¯¹å¤–æä¾›æœåŠ¡ï¼Œä¾‹å¦‚ä½ æœ‰ä¸‰ä¸ªåŸå­æ ¡éªŒåŠŸèƒ½(Aï¼šèº«ä»½è¯ã€Bï¼šé“¶è¡Œå¡ã€Cï¼šæ‰‹æœºå·)æœåŠ¡å¹¶å¯¹å¤–æä¾›è°ƒç”¨ä½¿ç”¨ã€‚æœ‰äº›è°ƒç”¨æ–¹éœ€è¦ä½¿ç”¨ABç»„åˆï¼Œæœ‰äº›è°ƒç”¨æ–¹éœ€è¦ä½¿ç”¨åˆ°CBAç»„åˆï¼Œè¿˜æœ‰ä¸€äº›å¯èƒ½åªä½¿ç”¨ä¸‰è€…ä¸­çš„ä¸€ä¸ªã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä½ å°±å¯ä»¥ä½¿ç”¨ç»„åˆæ¨¡å¼è¿›è¡Œæ„å»ºæœåŠ¡ï¼Œå¯¹äºä¸åŒç±»å‹çš„è°ƒç”¨æ–¹é…ç½®ä¸åŒçš„ç»„ç»‡å…³ç³»æ ‘ï¼Œè€Œè¿™ä¸ªæ ‘ç»“æ„ä½ å¯ä»¥é…ç½®åˆ°æ•°æ®åº“ä¸­ä¹Ÿå¯ä»¥ä¸æ–­çš„é€šè¿‡å›¾å½¢ç•Œé¢æ¥æ§åˆ¶æ ‘ç»“æ„ã€‚

æ‰€ä»¥ä¸åŒçš„è®¾è®¡æ¨¡å¼ç”¨åœ¨æ°å½“å¥½å¤„çš„åœºæ™¯å¯ä»¥è®©ä»£ç é€»è¾‘éå¸¸æ¸…æ™°å¹¶æ˜“äºæ‰©å±•ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å‡å°‘å›¢é˜Ÿæ–°å¢äººå‘˜å¯¹é¡¹ç›®çš„å­¦ä¹ æˆæœ¬ã€‚

# æ¡ˆä¾‹åœºæ™¯æ¨¡æ‹Ÿ

![](images/Snipaste_2020-10-22_23-48-02.png)

ä»¥ä¸Šæ˜¯ä¸€ä¸ªéå¸¸ç®€åŒ–ç‰ˆçš„è¥é”€è§„åˆ™å†³ç­–æ ‘ï¼Œæ ¹æ®æ€§åˆ«ã€å¹´é¾„æ¥å‘æ”¾ä¸åŒç±»å‹çš„ä¼˜æƒ åˆ¸ï¼Œæ¥åˆºæ¿€æ¶ˆè´¹èµ·åˆ°ç²¾å‡†ç”¨æˆ·ä¿ƒæ´»çš„ç›®çš„ã€‚

è™½ç„¶ä¸€éƒ¨åˆ†å°ä¼™ä¼´å¯èƒ½å¹¶æ²¡æœ‰å¼€å‘è¿‡è¥é”€åœºæ™¯ï¼Œä½†ä½ å¯èƒ½æ—¶æ—¶åˆ»åˆ»çš„è¢«è¥é”€ç€ã€‚æ¯”å¦‚ä½ å»ç»å¸¸æµè§ˆç”·æ€§å–œæ¬¢çš„æœºæ¢°é”®ç›˜ã€ç¬”è®°æœ¬ç”µè„‘ã€æ±½è½¦è£…é¥°ç­‰ç­‰ï¼Œé‚£ä¹ˆä¹…ç»™ä½ æ¨èæ­¤ç±»çš„ä¼˜æƒ åˆ¸åˆºæ¿€ä½ æ¶ˆè´¹ã€‚é‚£ä¹ˆå¦‚æœä½ è´­ç‰©ä¸å¤šï¼Œæˆ–è€…é’±ä¸åœ¨è‡ªå·±æ‰‹é‡Œã€‚é‚£ä¹ˆä½ æ˜¯å¦æ‰“è¿‡è½¦ï¼Œæœ‰ä¸€æ®µæ—¶é—´ç»å¸¸æœ‰å°ä¼™ä¼´å–Šï¼Œä¸ºä»€ä¹ˆåŒæ ·çš„è·ç¦»ä»–å°±10å…ƒï¼Œæˆ‘å°±15å…ƒå‘¢ï¼Ÿå…¶å®è¿™äº›éƒ½æ˜¯è¢«è¥é”€çš„æ¡ˆä¾‹ï¼Œä¸€èˆ¬å¯¹äºä¸å¸¸ä½¿ç”¨è½¯ä»¶çš„å°ä¼™ä¼´ï¼Œç»å¸¸ä¼šè¿›è¡Œç¨å¾®å¤§åŠ›åº¦çš„ä¿ƒæ´»ï¼Œå¢åŠ ç”¨æˆ·ç²˜æ€§ã€‚

é‚£ä¹ˆåœ¨è¿™é‡Œæˆ‘ä»¬å°±æ¨¡æ‹Ÿä¸€ä¸ªç±»ä¼¼çš„å†³ç­–åœºæ™¯ï¼Œä½“ç°å‡ºç»„åˆæ¨¡å¼åœ¨å…¶ä¸­èµ·åˆ°çš„é‡è¦æ€§ã€‚å¦å¤–ï¼Œç»„åˆæ¨¡å¼ä¸åªæ˜¯å¯ä»¥è¿ç”¨äºè§„åˆ™å†³ç­–æ ‘ï¼Œè¿˜å¯ä»¥åšæœåŠ¡åŒ…è£…å°†ä¸åŒçš„æ¥å£è¿›è¡Œç»„åˆé…ç½®ï¼Œå¯¹å¤–æä¾›æœåŠ¡èƒ½åŠ›ï¼Œå‡å°‘å¼€å‘æˆæœ¬ã€‚

# åˆå§‹å®ç°

![](images/Snipaste_2020-10-22_23-52-35.png)

## å·¥ç¨‹ç»“æ„

```
itstack-demo-design-8-01
â””â”€â”€ src
    â””â”€â”€ main
        â””â”€â”€ java
            â””â”€â”€ org.itstack.demo.design
                â””â”€â”€ EngineController.java
```

## ä»£ç å®ç°

```java
public class EngineController {

    private Logger logger = LoggerFactory.getLogger(EngineController.class);

    public String process(final String userId, final String userSex, final int userAge) {

        logger.info("ifelseå®ç°æ–¹å¼åˆ¤æ–­ç”¨æˆ·ç»“æœã€‚userIdï¼š{} userSexï¼š{} userAgeï¼š{}", userId, userSex, userAge);

        if ("man".equals(userSex)) {
            if (userAge < 25) {
                return "æœå®A";
            }

            if (userAge >= 25) {
                return "æœå®B";
            }
        }

        if ("woman".equals(userSex)) {
            if (userAge < 25) {
                return "æœå®C";
            }

            if (userAge >= 25) {
                return "æœå®D";
            }
        }

        return null;
    }
}
```

## æµ‹è¯•éªŒè¯

```java
@Test
public void test_EngineController() {
    EngineController engineController = new EngineController();
    String process = engineController.process("Oli09pLkdjh", "man", 29);
    logger.info("æµ‹è¯•ç»“æœï¼š{}", process);
}
```

# ä»£ç é‡æ„

æ¥ä¸‹æ¥çš„é‡æ„éƒ¨åˆ†ä»£ç æ”¹åŠ¨é‡ç›¸å¯¹æ¥è¯´ä¼šæ¯”è¾ƒå¤§ä¸€äº›ï¼Œä¸ºäº†è®©æˆ‘ä»¬å¯ä»¥æŠŠä¸åŒç±»å‹çš„å†³ç­–èŠ‚ç‚¹å’Œæœ€ç»ˆçš„æœå®ç»„è£…æˆä¸€æ£µå¯è¢«è¿è¡Œçš„å†³ç­–æ ‘ï¼Œéœ€è¦åšé€‚é…è®¾è®¡å’Œå·¥å‚æ–¹æ³•è°ƒç”¨ï¼Œå…·ä½“ä¼šä½“ç°åœ¨å®šä¹‰æ¥å£ä»¥åŠæŠ½è±¡ç±»å’Œåˆå§‹åŒ–é…ç½®å†³ç­–èŠ‚ç‚¹(æ€§åˆ«ã€å¹´é¾„)ä¸Šã€‚å»ºè®®è¿™éƒ¨åˆ†ä»£ç å¤šé˜…è¯»å‡ æ¬¡ï¼Œæœ€å¥½å®è·µä¸‹ã€‚

## å·¥ç¨‹ç»“æ„

```
itstack-demo-design-8-02
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚      â””â”€â”€ org.itstack.demo.design.domain
    â”‚          â”œâ”€â”€ model
    â”‚          â”‚   â”œâ”€â”€ aggregates
    â”‚          â”‚   â”‚   â””â”€â”€ TreeRich.java
    â”‚          â”‚   â””â”€â”€ vo
    â”‚          â”‚       â”œâ”€â”€ EngineResult.java
    â”‚          â”‚       â”œâ”€â”€ TreeNode.java
    â”‚          â”‚       â”œâ”€â”€ TreeNodeLink.java    
    â”‚          â”‚       â””â”€â”€ TreeRoot.java	
    â”‚          â””â”€â”€ service
    â”‚              â”œâ”€â”€ engine
    â”‚              â”‚   â”œâ”€â”€ impl	
    â”‚              â”‚   â”‚   â””â”€â”€ TreeEngineHandle.java	   
    â”‚              â”‚   â”œâ”€â”€ EngineBase.java 
    â”‚              â”‚   â”œâ”€â”€ EngineConfig.java       
    â”‚              â”‚   â””â”€â”€ IEngine.java	
    â”‚              â””â”€â”€ logic
    â”‚                  â”œâ”€â”€ impl	
    â”‚                  â”‚   â”œâ”€â”€ LogicFilter.java	 
    â”‚                  â”‚   â””â”€â”€ LogicFilter.java	    
    â”‚                  â””â”€â”€ LogicFilter.java	
    â””â”€â”€ test
         â””â”€â”€ java
             â””â”€â”€ org.itstack.demo.design.test
                 â””â”€â”€ ApiTest.java
```

## ç»„åˆæ¨¡å¼æ¨¡å‹ç»“æ„

![](images/Snipaste_2020-10-23_00-01-06.png)

- é¦–å…ˆå¯ä»¥çœ‹ä¸‹é»‘è‰²æ¡†æ¡†çš„æ¨¡æ‹ŸæŒ‡å¯¼æ ‘ç»“æ„ï¼š1ã€11ã€12ã€111ã€112ã€121ã€122ï¼Œè¿™æ˜¯ä¸€ç»„æ ‘ç»“æ„çš„IDï¼Œå¹¶ç”±èŠ‚ç‚¹ä¸²è”ç»„åˆå‡ºä¸€æ£µå…³ç³»æ ‘ã€‚

- æ¥ä¸‹æ¥æ˜¯ç±»å›¾éƒ¨åˆ†ï¼Œå·¦ä¾§æ˜¯ä»LogicFilterå¼€å§‹å®šä¹‰é€‚é…çš„å†³ç­–è¿‡æ»¤å™¨ï¼ŒBaseLogicæ˜¯å¯¹æ¥å£çš„å®ç°ï¼Œæä¾›æœ€åŸºæœ¬çš„é€šç”¨æ–¹æ³•ã€‚UserAgeFilterã€UserGenerFilterï¼Œæ˜¯ä¸¤ä¸ªå…·ä½“çš„å®ç°ç±»ç”¨äºåˆ¤æ–­å¹´é¾„å’Œæ€§åˆ«ã€‚

- æœ€ååˆ™æ˜¯å¯¹è¿™é¢—å¯ä»¥è¢«ç»„ç»‡å‡ºæ¥çš„å†³ç­–æ ‘ï¼Œè¿›è¡Œæ‰§è¡Œçš„å¼•æ“ã€‚åŒæ ·å®šä¹‰äº†å¼•æ“æ¥å£å’ŒåŸºç¡€çš„é…ç½®ï¼Œåœ¨é…ç½®é‡Œé¢è®¾å®šäº†éœ€è¦çš„æ¨¡å¼å†³ç­–èŠ‚ç‚¹ã€‚
  -  ```java
      static {
           logicFilterMap = new ConcurrentHashMap<>();
           logicFilterMap.put("userAge", new UserAgeFilter());
           logicFilterMap.put("userGender", new UserGenderFilter());
      }
      ```
- æ¥ä¸‹æ¥ä¼šå¯¹æ¯ä¸€ä¸ªç±»è¿›è¡Œç»†è‡´çš„è®²è§£ã€‚

## ä»£ç å®ç°

## åŸºç¡€å¯¹è±¡

![](images/Snipaste_2020-10-23_00-05-29.png)

## æ ‘èŠ‚ç‚¹é€»è¾‘è¿‡æ»¤å™¨æ¥å£

```java
public interface LogicFilter {

    /**
     * é€»è¾‘å†³ç­–å™¨
     *
     * @param matterValue          å†³ç­–å€¼
     * @param treeNodeLineInfoList å†³ç­–èŠ‚ç‚¹
     * @return ä¸‹ä¸€ä¸ªèŠ‚ç‚¹Id
     */
    Long filter(String matterValue, List<TreeNodeLink> treeNodeLineInfoList);

    /**
     * è·å–å†³ç­–å€¼
     *
     * @param decisionMatter å†³ç­–ç‰©æ–™
     * @return å†³ç­–å€¼
     */
    String matterValue(Long treeId, String userId, Map<String, String> decisionMatter);
}
```

è¿™ä¸€éƒ¨åˆ†å®šä¹‰äº†é€‚é…çš„é€šç”¨æ¥å£ï¼Œé€»è¾‘å†³ç­–å™¨ã€è·å–å†³ç­–å€¼ï¼Œè®©æ¯ä¸€ä¸ªæä¾›å†³ç­–èƒ½åŠ›çš„èŠ‚ç‚¹éƒ½å¿…é¡»å®ç°æ­¤æ¥å£ï¼Œä¿è¯ç»Ÿä¸€æ€§ã€‚

## å†³ç­–æŠ½è±¡ç±»æä¾›åŸºç¡€æœåŠ¡

```java
public abstract class BaseLogic implements LogicFilter {

    @Override
    public Long filter(String matterValue, List<TreeNodeLink> treeNodeLinkList) {
        for (TreeNodeLink nodeLine : treeNodeLinkList) {
            if (decisionLogic(matterValue, nodeLine)) return nodeLine.getNodeIdTo();
        }
        return 0L;
    }

    @Override
    public abstract String matterValue(Long treeId, String userId, Map<String, String> decisionMatter);

    private boolean decisionLogic(String matterValue, TreeNodeLink nodeLink) {
        switch (nodeLink.getRuleLimitType()) {
            case 1:
                return matterValue.equals(nodeLink.getRuleLimitValue());
            case 2:
                return Double.parseDouble(matterValue) > Double.parseDouble(nodeLink.getRuleLimitValue());
            case 3:
                return Double.parseDouble(matterValue) < Double.parseDouble(nodeLink.getRuleLimitValue());
            case 4:
                return Double.parseDouble(matterValue) <= Double.parseDouble(nodeLink.getRuleLimitValue());
            case 5:
                return Double.parseDouble(matterValue) >= Double.parseDouble(nodeLink.getRuleLimitValue());
            default:
                return false;
        }
    }
}
```

- åœ¨æŠ½è±¡æ–¹æ³•ä¸­å®ç°äº†æ¥å£æ–¹æ³•ï¼ŒåŒæ—¶å®šä¹‰äº†åŸºæœ¬çš„å†³ç­–æ–¹æ³•ï¼›1ã€2ã€3ã€4ã€5ï¼Œç­‰äºã€å°äºã€å¤§äºã€å°äºç­‰äºã€å¤§äºç­‰äºçš„åˆ¤æ–­é€»è¾‘ã€‚
- åŒæ—¶å®šä¹‰äº†æŠ½è±¡æ–¹æ³•ï¼Œè®©æ¯ä¸€ä¸ªå®ç°æ¥å£çš„ç±»éƒ½å¿…é¡»æŒ‰ç…§è§„åˆ™æä¾›å†³ç­–å€¼ï¼Œè¿™ä¸ªå†³ç­–å€¼ç”¨äºåšé€»è¾‘æ¯”å¯¹ã€‚

## æ ‘èŠ‚ç‚¹é€»è¾‘å®ç°ç±»

å¹´é¾„èŠ‚ç‚¹

```java
public class UserAgeFilter extends BaseLogic {

    @Override
    public String matterValue(Long treeId, String userId, Map<String, String> decisionMatter) {
        return decisionMatter.get("age");
    }
}
```

æ€§åˆ«èŠ‚ç‚¹

```java
public class UserGenderFilter extends BaseLogic {

    @Override
    public String matterValue(Long treeId, String userId, Map<String, String> decisionMatter) {
        return decisionMatter.get("gender");
    }
}
```

- ä»¥ä¸Šä¸¤ä¸ªå†³ç­–é€»è¾‘çš„èŠ‚ç‚¹è·å–å€¼çš„æ–¹å¼éƒ½éå¸¸ç®€å•ï¼Œåªæ˜¯è·å–ç”¨æˆ·çš„å…¥å‚å³å¯ã€‚å®é™…çš„ä¸šåŠ¡å¼€å‘å¯ä»¥ä»æ•°æ®åº“ã€RPCæ¥å£ã€ç¼“å­˜è¿ç®—ç­‰å„ç§æ–¹å¼è·å–ã€‚

## å†³ç­–å¼•æ“æ¥å£å®šä¹‰

```java
public interface IEngine {

    EngineResult process(final Long treeId, final String userId, TreeRich treeRich, final Map<String, String> decisionMatter);

}
```

- å¯¹äºä½¿ç”¨æ–¹æ¥è¯´ä¹ŸåŒæ ·éœ€è¦å®šä¹‰ç»Ÿä¸€çš„æ¥å£æ“ä½œï¼Œè¿™æ ·çš„å¥½å¤„éå¸¸æ–¹ä¾¿åç»­æ‹“å±•å‡ºä¸åŒç±»å‹çš„å†³ç­–å¼•æ“ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å»ºé€ ä¸åŒçš„å†³ç­–å·¥å‚ã€‚

## å†³ç­–èŠ‚ç‚¹é…ç½®

```java
public class EngineConfig {

    static Map<String, LogicFilter> logicFilterMap;

    static {
        logicFilterMap = new ConcurrentHashMap<>();
        logicFilterMap.put("userAge", new UserAgeFilter());
        logicFilterMap.put("userGender", new UserGenderFilter());
    }

    public Map<String, LogicFilter> getLogicFilterMap() {
        return logicFilterMap;
    }

    public void setLogicFilterMap(Map<String, LogicFilter> logicFilterMap) {
        this.logicFilterMap = logicFilterMap;
    }
}
```

åœ¨è¿™é‡Œå°†å¯æä¾›æœåŠ¡çš„å†³ç­–èŠ‚ç‚¹é…ç½®åˆ°mapç»“æ„ä¸­ï¼Œå¯¹äºè¿™æ ·çš„mapç»“æ„å¯ä»¥æŠ½å–åˆ°æ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆå°±å¯ä»¥éå¸¸æ–¹ä¾¿çš„ç®¡ç†ã€‚

## åŸºç¡€å†³ç­–å¼•æ“åŠŸèƒ½

```java
public abstract class EngineBase extends EngineConfig implements IEngine {

    private Logger logger = LoggerFactory.getLogger(EngineBase.class);

    @Override
    public abstract EngineResult process(Long treeId, String userId, TreeRich treeRich, Map<String, String> decisionMatter);

    protected TreeNode engineDecisionMaker(TreeRich treeRich, Long treeId, String userId, Map<String, String> decisionMatter) {
        TreeRoot treeRoot = treeRich.getTreeRoot();
        Map<Long, TreeNode> treeNodeMap = treeRich.getTreeNodeMap();
        // è§„åˆ™æ ‘æ ¹ID
        Long rootNodeId = treeRoot.getTreeRootNodeId();
        TreeNode treeNodeInfo = treeNodeMap.get(rootNodeId);
        //èŠ‚ç‚¹ç±»å‹[NodeType]ï¼›1å­å¶ã€2æœå®
        while (treeNodeInfo.getNodeType().equals(1)) {
            String ruleKey = treeNodeInfo.getRuleKey();
            LogicFilter logicFilter = logicFilterMap.get(ruleKey);
            String matterValue = logicFilter.matterValue(treeId, userId, decisionMatter);
            Long nextNode = logicFilter.filter(matterValue, treeNodeInfo.getTreeNodeLinkList());
            treeNodeInfo = treeNodeMap.get(nextNode);
            logger.info("å†³ç­–æ ‘å¼•æ“=>{} userIdï¼š{} treeIdï¼š{} treeNodeï¼š{} ruleKeyï¼š{} matterValueï¼š{}", treeRoot.getTreeName(), userId, treeId, treeNodeInfo.getTreeNodeId(), ruleKey, matterValue);
        }
        return treeNodeInfo;
    }

}
```

- è¿™é‡Œä¸»è¦æä¾›å†³ç­–æ ‘æµç¨‹çš„å¤„ç†è¿‡ç¨‹ï¼Œæœ‰ç‚¹åƒé€šè¿‡é“¾è·¯çš„å…³ç³»(æ€§åˆ«ã€å¹´é¾„)åœ¨äºŒå‰æ ‘ä¸­å¯»æ‰¾æœå®èŠ‚ç‚¹çš„è¿‡ç¨‹ã€‚
- åŒæ—¶æä¾›ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæ‰§è¡Œå†³ç­–æµç¨‹çš„æ–¹æ³•ä¾›å¤–éƒ¨å»åšå…·ä½“çš„å®ç°ã€‚

## å†³ç­–å¼•æ“çš„å®ç°

```java
public class TreeEngineHandle extends EngineBase {

    @Override
    public EngineResult process(Long treeId, String userId, TreeRich treeRich, Map<String, String> decisionMatter) {
        // å†³ç­–æµç¨‹
        TreeNode treeNode = engineDecisionMaker(treeRich, treeId, userId, decisionMatter);
        // å†³ç­–ç»“æœ
        return new EngineResult(userId, treeId, treeNode.getTreeNodeId(), treeNode.getNodeValue());
    }

}
```
è¿™é‡Œå¯¹äºå†³ç­–å¼•æ“çš„å®ç°å°±éå¸¸ç®€å•äº†ï¼Œé€šè¿‡ä¼ é€’è¿›æ¥çš„å¿…è¦ä¿¡æ¯ï¼›å†³ç­–æ ‘ä¿¡æ¯ã€å†³ç­–ç‰©æ–™å€¼ï¼Œæ¥åšå…·ä½“çš„æ ‘å½¢ç»“æ„å†³ç­–ã€‚

# æµ‹è¯•éªŒè¯

## ç»„è£…æ ‘å…³ç³»

```java
@Before
public void init() {
    // èŠ‚ç‚¹ï¼š1
    TreeNode treeNode_01 = new TreeNode();
    treeNode_01.setTreeId(10001L);
    treeNode_01.setTreeNodeId(1L);
    treeNode_01.setNodeType(1);
    treeNode_01.setNodeValue(null);
    treeNode_01.setRuleKey("userGender");
    treeNode_01.setRuleDesc("ç”¨æˆ·æ€§åˆ«[ç”·/å¥³]");
    // é“¾æ¥ï¼š1->11
    TreeNodeLink treeNodeLink_11 = new TreeNodeLink();
    treeNodeLink_11.setNodeIdFrom(1L);
    treeNodeLink_11.setNodeIdTo(11L);
    treeNodeLink_11.setRuleLimitType(1);
    treeNodeLink_11.setRuleLimitValue("man");
    // é“¾æ¥ï¼š1->12
    TreeNodeLink treeNodeLink_12 = new TreeNodeLink();
    treeNodeLink_12.setNodeIdTo(1L);
    treeNodeLink_12.setNodeIdTo(12L);
    treeNodeLink_12.setRuleLimitType(1);
    treeNodeLink_12.setRuleLimitValue("woman");
    List<TreeNodeLink> treeNodeLinkList_1 = new ArrayList<>();
    treeNodeLinkList_1.add(treeNodeLink_11);
    treeNodeLinkList_1.add(treeNodeLink_12);
    treeNode_01.setTreeNodeLinkList(treeNodeLinkList_1);
    // èŠ‚ç‚¹ï¼š11
    TreeNode treeNode_11 = new TreeNode();
    treeNode_11.setTreeId(10001L);
    treeNode_11.setTreeNodeId(11L);
    treeNode_11.setNodeType(1);
    treeNode_11.setNodeValue(null);
    treeNode_11.setRuleKey("userAge");
    treeNode_11.setRuleDesc("ç”¨æˆ·å¹´é¾„");
    // é“¾æ¥ï¼š11->111
    TreeNodeLink treeNodeLink_111 = new TreeNodeLink();
    treeNodeLink_111.setNodeIdFrom(11L);
    treeNodeLink_111.setNodeIdTo(111L);
    treeNodeLink_111.setRuleLimitType(3);
    treeNodeLink_111.setRuleLimitValue("25");
    // é“¾æ¥ï¼š11->112
    TreeNodeLink treeNodeLink_112 = new TreeNodeLink();
    treeNodeLink_112.setNodeIdFrom(11L);
    treeNodeLink_112.setNodeIdTo(112L);
    treeNodeLink_112.setRuleLimitType(5);
    treeNodeLink_112.setRuleLimitValue("25");
    List<TreeNodeLink> treeNodeLinkList_11 = new ArrayList<>();
    treeNodeLinkList_11.add(treeNodeLink_111);
    treeNodeLinkList_11.add(treeNodeLink_112);
    treeNode_11.setTreeNodeLinkList(treeNodeLinkList_11);
    // èŠ‚ç‚¹ï¼š12
    TreeNode treeNode_12 = new TreeNode();
    treeNode_12.setTreeId(10001L);
    treeNode_12.setTreeNodeId(12L);
    treeNode_12.setNodeType(1);
    treeNode_12.setNodeValue(null);
    treeNode_12.setRuleKey("userAge");
    treeNode_12.setRuleDesc("ç”¨æˆ·å¹´é¾„");
    // é“¾æ¥ï¼š12->121
    TreeNodeLink treeNodeLink_121 = new TreeNodeLink();
    treeNodeLink_121.setNodeIdFrom(12L);
    treeNodeLink_121.setNodeIdTo(121L);
    treeNodeLink_121.setRuleLimitType(3);
    treeNodeLink_121.setRuleLimitValue("25");
    // é“¾æ¥ï¼š12->122
    TreeNodeLink treeNodeLink_122 = new TreeNodeLink();
    treeNodeLink_122.setNodeIdFrom(12L);
    treeNodeLink_122.setNodeIdTo(122L);
    treeNodeLink_122.setRuleLimitType(5);
    treeNodeLink_122.setRuleLimitValue("25");
    List<TreeNodeLink> treeNodeLinkList_12 = new ArrayList<>();
    treeNodeLinkList_12.add(treeNodeLink_121);
    treeNodeLinkList_12.add(treeNodeLink_122);
    treeNode_12.setTreeNodeLinkList(treeNodeLinkList_12);
    // èŠ‚ç‚¹ï¼š111
    TreeNode treeNode_111 = new TreeNode();
    treeNode_111.setTreeId(10001L);
    treeNode_111.setTreeNodeId(111L);
    treeNode_111.setNodeType(2);
    treeNode_111.setNodeValue("æœå®A");
    // èŠ‚ç‚¹ï¼š112
    TreeNode treeNode_112 = new TreeNode();
    treeNode_112.setTreeId(10001L);
    treeNode_112.setTreeNodeId(112L);
    treeNode_112.setNodeType(2);
    treeNode_112.setNodeValue("æœå®B");
    // èŠ‚ç‚¹ï¼š121
    TreeNode treeNode_121 = new TreeNode();
    treeNode_121.setTreeId(10001L);
    treeNode_121.setTreeNodeId(121L);
    treeNode_121.setNodeType(2);
    treeNode_121.setNodeValue("æœå®C");
    // èŠ‚ç‚¹ï¼š122
    TreeNode treeNode_122 = new TreeNode();
    treeNode_122.setTreeId(10001L);
    treeNode_122.setTreeNodeId(122L);
    treeNode_122.setNodeType(2);
    treeNode_122.setNodeValue("æœå®D");
    // æ ‘æ ¹
    TreeRoot treeRoot = new TreeRoot();
    treeRoot.setTreeId(10001L);
    treeRoot.setTreeRootNodeId(1L);
    treeRoot.setTreeName("è§„åˆ™å†³ç­–æ ‘");
    Map<Long, TreeNode> treeNodeMap = new HashMap<>();
    treeNodeMap.put(1L, treeNode_01);
    treeNodeMap.put(11L, treeNode_11);
    treeNodeMap.put(12L, treeNode_12);
    treeNodeMap.put(111L, treeNode_111);
    treeNodeMap.put(112L, treeNode_112);
    treeNodeMap.put(121L, treeNode_121);
    treeNodeMap.put(122L, treeNode_122);
    treeRich = new TreeRich(treeRoot, treeNodeMap);
}
```

![](images/Snipaste_2020-10-23_00-17-09.png)

- é‡è¦ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯ç»„åˆæ¨¡å¼éå¸¸é‡è¦çš„ä½¿ç”¨ï¼Œåœ¨æˆ‘ä»¬å·²ç»å»ºé€ å¥½çš„å†³ç­–æ ‘å…³ç³»ä¸‹ï¼Œå¯ä»¥åˆ›å»ºå‡ºæ ‘çš„å„ä¸ªèŠ‚ç‚¹ï¼Œä»¥åŠå¯¹èŠ‚ç‚¹é—´ä½¿ç”¨é“¾è·¯è¿›è¡Œä¸²è”ã€‚
- åŠæ—¶åç»­ä½ éœ€è¦åšä»»ä½•ä¸šåŠ¡çš„æ‰©å±•éƒ½å¯ä»¥åœ¨é‡Œé¢æ·»åŠ ç›¸åº”çš„èŠ‚ç‚¹ï¼Œå¹¶åšåŠ¨æ€åŒ–çš„é…ç½®ã€‚
- å…³äºè¿™éƒ¨åˆ†æ‰‹åŠ¨ç»„åˆçš„æ–¹å¼å¯ä»¥æå–åˆ°æ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆä¹Ÿå°±å¯ä»¥æ‰©å±•åˆ°å›¾å½¢ç•Œé¢çš„è¿›è¡Œé…ç½®æ“ä½œã€‚

## ç¼–å†™æµ‹è¯•ç±»

```java
@Test
public void test_tree() {
    logger.info("å†³ç­–æ ‘ç»„åˆç»“æ„ä¿¡æ¯ï¼š\r\n" + JSON.toJSONString(treeRich));
    
    IEngine treeEngineHandle = new TreeEngineHandle();
    Map<String, String> decisionMatter = new HashMap<>();
    decisionMatter.put("gender", "man");
    decisionMatter.put("age", "29");
    
    EngineResult result = treeEngineHandle.process(10001L, "Oli09pLkdjh", treeRich, decisionMatter);
    
    logger.info("æµ‹è¯•ç»“æœï¼š{}", JSON.toJSONString(result));
}
```

- åœ¨è¿™é‡Œæä¾›äº†è°ƒç”¨çš„é€šè¿‡ç»„ç»‡æ¨¡å¼åˆ›å»ºå‡ºæ¥çš„æµç¨‹å†³ç­–æ ‘ï¼Œè°ƒç”¨çš„æ—¶å€™ä¼ å…¥äº†å†³ç­–æ ‘çš„IDï¼Œé‚£ä¹ˆå¦‚æœæ˜¯ä¸šåŠ¡å¼€å‘ä¸­å°±å¯ä»¥æ–¹ä¾¿çš„è§£è€¦å†³ç­–æ ‘ä¸ä¸šåŠ¡çš„ç»‘å®šå…³ç³»ï¼ŒæŒ‰éœ€ä¼ å…¥å†³ç­–æ ‘IDå³å¯ã€‚
- æ­¤å¤–å…¥å‚æˆ‘ä»¬è¿˜æä¾›äº†éœ€è¦å¤„ç†ï¼›ç”·(man)ã€å¹´é¾„(29å²)ï¼Œçš„å‚æ•°ä¿¡æ¯ã€‚

# æ€»ç»“

- ä»ä»¥ä¸Šçš„å†³ç­–æ ‘åœºæ™¯æ¥çœ‹ï¼Œç»„åˆæ¨¡å¼çš„ä¸»è¦è§£å†³çš„æ˜¯ä¸€ç³»åˆ—ç®€å•é€»è¾‘èŠ‚ç‚¹æˆ–è€…æ‰©å±•çš„å¤æ‚é€»è¾‘èŠ‚ç‚¹åœ¨ä¸åŒç»“æ„çš„ç»„ç»‡ä¸‹ï¼Œå¯¹äºå¤–éƒ¨çš„è°ƒç”¨æ˜¯ä»ç„¶å¯ä»¥éå¸¸ç®€å•çš„ã€‚
- è¿™éƒ¨åˆ†è®¾è®¡æ¨¡å¼ä¿è¯äº†å¼€é—­åŸåˆ™ï¼Œæ— éœ€æ›´æ”¹æ¨¡å‹ç»“æ„ä½ å°±å¯ä»¥æä¾›æ–°çš„é€»è¾‘èŠ‚ç‚¹çš„ä½¿ç”¨å¹¶é…åˆç»„ç»‡å‡ºæ–°çš„å…³ç³»æ ‘ã€‚ä½†å¦‚æœæ˜¯ä¸€äº›åŠŸèƒ½å·®å¼‚åŒ–éå¸¸å¤§çš„æ¥å£è¿›è¡ŒåŒ…è£…å°±ä¼šå˜å¾—æ¯”è¾ƒå›°éš¾ï¼Œä½†ä¹Ÿä¸æ˜¯ä¸èƒ½å¾ˆå¥½çš„å¤„ç†ï¼Œåªä¸è¿‡éœ€è¦åšä¸€äº›é€‚é…å’Œç‰¹å®šåŒ–çš„å¼€å‘ã€‚
- å¾ˆå¤šæ—¶å€™å› ä¸ºä½ çš„æè‡´è¿½æ±‚å’Œç¨æœ‰å€”å¼ºçš„å·¥åŒ ç²¾ç¥ï¼Œå³ä½¿åœ¨é¢å¯¹åŒæ ·çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä½ èƒ½å®Œæˆå‡ºæœ€å¥½çš„ä»£ç ç»“æ„å’Œæœ€æ˜“äºæ‰©å±•çš„æŠ€æœ¯æ¶æ„ã€‚ä¸è¦è¢«è¿œä¸èƒ½ç»™ä½ æŒ‡å¯¼æå‡èƒ½åŠ›çš„å½±å“åˆ°æ”¾å¼ƒè‡ªå·±çš„è¿½æ±‚ï¼


# å› ä¸ºä¸æ‡‚ï¼Œå°±å¤šè¯»ä¸€ç¯‡åšæ–‡

PSï¼š[åšæ–‡é“¾æ¥](https://blog.csdn.net/qq_40709468/article/details/81990084)

# ç»„åˆæ¨¡å¼çš„æ¦‚å¿µ

ç»„åˆæ¨¡å¼ï¼šç»„åˆå¤šä¸ªå¯¹è±¡å½¢æˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºæœ‰æ•´ä½“-éƒ¨åˆ†å…³ç³»å±‚æ¬¡ç»“æ„ï¼Œç»„åˆæ¨¡å¼å¯ä»¥è®©å®¢æˆ·ç«¯ç»Ÿä¸€å¯¹å¾…å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡

ç»„åˆæ¨¡å¼æœ‰ç‚¹éš¾ç†è§£ï¼æ ‘å½¢ç»“æ„å°±æ˜¯ç»„åˆæ¨¡å¼çš„ä½“ç°ã€‚æ–‡ä»¶ä¸­å¯ä»¥åŒ…å«å­æ–‡ä»¶å’Œå­æ–‡ä»¶å¤¹ï¼Œä½†æ˜¯å­æ–‡ä»¶ä¸­ä¸èƒ½å¤Ÿå†ç»§ç»­åŒ…å«å­æ–‡ä»¶ã€‚ç®€å•çš„è¯´å­æ–‡ä»¶å°±æ˜¯æœ€åä¸€çº§åˆ«ã€‚ä¸Šå›¾å¥½å§ï¼Œä¸Šå›¾é è°±ã€‚

![](images/Snipaste_2020-10-23_09-25-17.png)

ç”±äºåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œæ¯”å¦‚æŸä¸ªæ–‡ä»¶å¤¹çš„æ–¹æ³•è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªä¼šéå†æ•´ä¸ªæ ‘å½¢ç»“æ„ï¼Œå¯»æ‰¾ä¹ŸåŒ…å«è¿™ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ï¼ˆæ–‡ä»¶ï¼‰ã€‚å¹¶ä¸”è°ƒç”¨æ‰§è¡Œï¼Œå…¶ä¸­ä¼šä½¿ç”¨åˆ°é€’å½’è°ƒç”¨çš„æœºåˆ¶å¯¹æ•´ä¸ªæœºæ„è¿›è¡Œå¤„ç†ã€‚ç”±äºï¼Œå®¹å™¨å’Œå¶å­çš„åŠŸèƒ½ä¸Šçš„åŒºåˆ«ï¼Œåœ¨ä½¿ç”¨è¿™äº›å¯¹è±¡ä»£ç ä¸­å¿…é¡»å»åˆ«çš„å¯¹å¾…å®¹å™¨å’Œå¶å­ï¼Œè¿™æ ·ä¼šè®©ç¨‹åºéå¸¸å¤æ‚ã€‚

æ‰€ä»¥ï¼Œç»„åˆæ¨¡å¼å°±å‡ºç°äº†ï¼é€šè¿‡ä¸€äº›è®¾è®¡ã€‚è®©å®¹å™¨ï¼ˆæ–‡ä»¶å¤¹ï¼‰å’Œå¶å­ï¼ˆæ–‡ä»¶ï¼‰ä½œä¸ºç›¸åŒçš„å¯¹è±¡æ¥å¤„ç†!

# ç»„åˆæ¨¡å¼çš„UMLå›¾

![](images/Snipaste_2020-10-23_09-26-07.png)

- component (æŠ½è±¡æ„ä»¶ï¼šå®¹å™¨)ï¼šå®ƒå¯ä»¥æ˜¯æ¥å£æˆ–è€…æŠ½è±¡ç±»ï¼Œä¸ºå¶å­æ„å»ºå’Œå­å®¹å™¨æ„å»ºå¯¹è±¡å£°æ˜æ¥å£ï¼Œåœ¨è¯¥è§’è‰²ä¸­å¯ä»¥åŒ…å«æ‰€æœ‰å­ç±»å…±æœ‰çš„è¡Œä¸ºçš„å®ç°å’Œå£°æ˜ã€‚åœ¨æŠ½è±¡æ„å»ºä¸­å®šä¹‰äº†è®¿é—®åŠç®¡ç†å®ƒçš„å­æ„ä»¶çš„æ–¹æ³•ï¼Œå¦‚å¢åŠ å­æ„ä»¶ï¼Œåˆ é™¤å­æ„ä»¶ï¼Œè·å–å­æ„ä»¶ç­‰ã€‚

- leaf(å¶å­æ„å»º)ï¼šå¶å­æ„å»ºå¯ä»¥è¯´å°±æ˜¯å„ç§ç±»å‹çš„æ–‡ä»¶ï¼å¶å­æ„å»ºæ²¡æœ‰å­æ„ä»¶ã€‚å®ƒå®ç°äº†æŠ½è±¡æ„å»ºä¸­çš„å®šä¹‰çš„è¡Œä¸ºã€‚å¯¹äºé‚£äº›è®¿é—®å­å®¹å™¨ï¼Œåˆ é™¤å­å®¹å™¨ï¼Œå¢åŠ å­å®¹å™¨çš„å°±æŠ¥é”™ã€‚

- compsite(å­å®¹å™¨æ„å»º)ï¼šå®ƒåœ¨ç»„åˆæ¨¡å¼ä¸­è¡¨ç¤ºå®¹å™¨èŠ‚ç‚¹å¯¹è±¡ï¼Œå®¹å™¨ç»“ç‚¹æ˜¯å­èŠ‚ç‚¹ï¼Œå¯ä»¥æ˜¯å­å®¹å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å¶å­æ„å»ºï¼Œå®ƒæä¾›ä¸€ä¸ªé›†åˆæ¥å­˜å‚¨å­èŠ‚ç‚¹ã€‚

# ç»„åˆæ¨¡å¼çš„å®ç°

æœ€ç®€å•çš„ä¸€ä¸ªå®ç°ï¼š

component

```java

public abstract class Component{
    //è¿™ä¸ªæ˜¯å®¹å™¨ç±»çš„æŠ½è±¡ç±»ï¼Œå®šä¹‰å¥½è¡Œä¸ºï¼Œå®šä¹‰åˆ›å»ºç§»é™¤å­å®¹å™¨çš„æ–¹æ³•æŠ½è±¡çš„ã€‚
    public abstract void addComposite(Component c); //æ·»åŠ æˆå‘˜
    public abstract void removeComposite(Component c);//ç§»é™¤æˆå‘˜
    public abstract Component getComposite(int i);//è·å–å­å®¹å™¨
    public abstract void operation();//ä¸šåŠ¡æ–¹æ³•
}
```

leaf

```java
public class Leaf extends Component{
    //é¦–å…ˆé‡å†™componentçš„æ–¹æ³•
    //å¶å­èŠ‚ç‚¹å…³é”®ç‚¹åœ¨äºä¸šåŠ¡
    public void Operation(){
        System.out.print("ä¸šåŠ¡æ–¹æ³•");
    }
    
    public void addComponent(Component c){
        //æç¤ºæŠ¥é”™å‘— ã€‚
        System.out.print("ä¸æ˜¯å­å®¹å™¨");
    }
   public void removeComponent(Component c){
        //æç¤ºæŠ¥é”™å‘— ã€‚
        System.out.print("ä¸æ˜¯å­å®¹å™¨");
    }
    public Component addComponent(int c){
        //æç¤ºæŠ¥é”™å‘— ã€‚
        System.out.print("ä¸æ˜¯å­å®¹å™¨");
        return null;
    }
}
```
composite

```java
public class Composite extends Component{
    //é¦–å…ˆæ¥ä¸€ä¸ªå­˜å‚¨çš„é›†åˆ
    private ArrayList<Component> list = new ArrayList<Component> ;
    public void addComponent(Component c){
            list.add(c);
    }
   public void removeComponent(Component c){
            list.remove(c);
    }
   public Component getComponent(int c){
            Component c1 =list.get(c);
             return c1;
    }
    public void operation(){
        for(Object obj:list){
            ((Component)obj).operation();
        }
    }
}
```

ä»¥ä¸Šæ˜¯ä¸€ä¸ªæœ€ç®€å•çš„å®ç°ã€‚ç°åœ¨æ¥ä¸€ä¸ªæ­£å¼ä¾‹å­ã€‚

æ€æ¯’è½¯ä»¶ï¼Œè¯¥è½¯ä»¶èƒ½å¤Ÿå¯¹æŸä¸ªæ–‡ä»¶å¤¹æ€æ¯’ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå¯¹æŸäº›æ–‡ä»¶æ€æ¯’ã€‚

AbstractFile: æŠ½è±¡æ–‡ä»¶ç±»ï¼Œå……å½“æŠ½è±¡æ„å»ºã€‚

```java
package compositePattern;
/**
 * 
* <p>Title: AbstractFiles</p>  
* <p>Description:in this class we are  use to test composite pattern </p>  
* @author HAND_WEILI  
* @date 2018å¹´8æœˆ26æ—¥
 */
public abstract class AbstractFiles {
  public abstract void add(AbstractFiles af);
  public abstract void remove(AbstractFiles af);
  public abstract AbstractFiles get(int  i);
  public abstract void killVirus();
}
```

å¶å­èŠ‚ç‚¹ï¼šæ–‡ä»¶ç±»å‹ï¼Œå°±å†™äº†ä¸€ç§ã€‚

```java
package compositePattern;
 
public class ImageFile extends AbstractFiles {
	private String name;
	
	public ImageFile(String name) {
		
		this.name=name;
	}
 
	@Override
	public void add(AbstractFiles af) {
		// TODO Auto-generated method stub
			System.out.println("ä¸æ”¯æŒè¯¥æ–¹æ³•");
	}
 
	@Override
	public void remove(AbstractFiles af) {
		// TODO Auto-generated method stub
		System.out.println("ä¸æ”¯æŒè¯¥æ–¹æ³•");
	}
 
	@Override
	public AbstractFiles get(int i) {
		// TODO Auto-generated method stub
		System.out.println("ä¸æ”¯æŒè¯¥æ–¹æ³•");
		return null;
	}
 
	@Override
	public void killVirus() {
		// TODO Auto-generated method stub
		System.out.println("å¼€å§‹è¿›è¡Œ--"+name+"--æ–‡ä»¶æ€æ¯’");
	}
}
```

æ–‡ä»¶ç±»å‹ï¼š

```java
package compositePattern;
 
import java.util.ArrayList;
 
public class Folder extends AbstractFiles {
	//æ–‡ä»¶å¤¹ç±»ï¼Œæ‰€æœ‰çš„éƒ½å¯ä»¥ç”¨
	private ArrayList<AbstractFiles> list = new ArrayList<AbstractFiles>();
	private String name;
	public Folder(String name) {
		this.name=name;
	}
 
	@Override
	public void add(AbstractFiles af) {
		list.add(af);
		System.out.println("æ·»åŠ æˆç‹—");
 
	}
 
	@Override
	public void remove(AbstractFiles af) {
		// TODO Auto-generated method stub
		if(list.remove(af)) {
			System.out.println("åˆ é™¤æˆåŠŸ");
		}else{
			System.out.println("åˆ é™¤å¤±è´¥");
		}
		
	}
 
	@Override
	public AbstractFiles get(int i) {
		// TODO Auto-generated method stub
		
		return list.get(i);
	}
 
	@Override
	public void killVirus() {
		// TODO Auto-generated method stub
		System.out.println("å¯¹æ–‡ä»¶å¤¹"+name+"è¿›è¡Œæ€æ¯’");
		//é€’å½’è°ƒç”¨
		for(Object o:list) {
		((AbstractFiles)o).killVirus();
		
		}
	}
}
```

æµ‹è¯•ï¼š

```java
package compositePattern;
 
public class Client {
	public static void main(String[] args) {
		//åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ç±»å‹
		AbstractFiles f1 = new Folder("ä¸»æ–‡ä»¶å¤¹");
		//åˆ›å»ºæ–‡ä»¶
		AbstractFiles file1= new ImageFile("å­™æ‚Ÿç©ºã€‚png");
		AbstractFiles file2= new ImageFile("é¾™ç .jpg");
		AbstractFiles file3= new ImageFile("å¸…å“¥å¨.gif");
		f1.add(file1);
		f1.add(file2);
		f1.add(file3);
		f1.killVirus();
		file1.killVirus();
	}
}
```

![](images/Snipaste_2020-10-23_09-30-53.png)

ç»„åˆæ¨¡å¼çš„ä¼˜ç¼ºç‚¹

ä¼˜ç‚¹ï¼š
- å¯ä»¥æ¸…æ¥šåœ°å®šä¹‰åˆ†å±‚æ¬¡çš„å¤æ‚ç±»å‹ï¼Œè¡¨ç¤ºå¯¹è±¡çš„å…¨éƒ¨å±‚æ¬¡æˆ–è€…éƒ¨åˆ†å±‚æ¬¡  ï¼Œå®ƒè®©å®¢æˆ·ç«¯å¿½ç•¥äº†å±‚æ¬¡çš„å·®å¼‚ï¼Œæ–¹ä¾¿å¯¹æ•´ä¸ªå±‚æ¬¡ç»è¡Œæ§åˆ¶ã€‚
- å®¢æˆ·ç«¯å¯ä»¥ä¸€è‡´çš„ä½¿ç”¨ä¸€ä¸ªç»„åˆæ¨¡å¼æˆ–å¯¹å•ä¸ªå¯¹è±¡ï¼Œä¸å¿…å…³å¿ƒå¤„ç†çš„æ˜¯å•ä¸ªå¯¹è±¡è¿˜æ˜¯æ•´ä¸ªç»„åˆç»“æ„ï¼Œç®€åŒ–äº†å®¢æˆ·ç«¯çš„ä»£ç ã€‚
- åœ¨ç»„åˆæ¨¡å¼ç§å¢åŠ æ–°çš„å®¹å™¨æ„ä»¶å’Œå¶å­æ„ä»¶éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— éœ€å¯¹ç°æœ‰ç±»åº“è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚
- ä¸ºæ ‘å½¢ç»“æ„çš„é¢å‘å¯¹è±¡å®ç°æä¾›äº†ä¸€ç§çµæ´»çš„è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡å¶å­å¯¹è±¡å’Œå®¹å™¨å¯¹è±¡çš„é€’å½’ç»„åˆå¯ä»¥å½¢æˆå¤æ‚çš„æ ‘å½¢æœºæ„ï¼Œä½†å¯¹æ ‘å½¢ç»“æ„çš„æ§åˆ¶å´å¾ˆç®€å•ã€‚

ç¼ºç‚¹ï¼š
- åœ¨å¢åŠ æ–°çš„æ„ä»¶æ—¶å°±æ¯”è¾ƒéš¾å’¯ã€‚è€Œä¸”éš¾ä»¥é™å®šï¼Œæœ‰æ—¶å€™å¸Œæœ›åœ¨ä¸€ä¸ªå®¹å™¨ç§èƒ½æœ‰æŸäº›ç‰¹å®šçš„å¯¹è±¡ï¼Œä¾‹å¦‚åœ¨æŸä¸ªæ–‡ä»¶å¤¹åªèƒ½æœ‰imageæˆ–è€…gifç­‰ã€‚è¿™ä¸ªå°±æ¯”è¾ƒéš¾ä»¥å®ç°ã€‚

# ç»„åˆæ¨¡å¼é€‚ç”¨åœºæ™¯

1. åœ¨å…·æœ‰æ•´ä½“å’Œéƒ¨åˆ†çš„å±‚æ¬¡ç»“æ„ç§å¸Œæœ›é€šè¿‡ä¸€ç§å¿½ç•¥æ•´ä½“ä¸ä¸ªä½“ä¹‹é—´å·®å¼‚çš„ï¼Œå®¢æˆ·ç«¯ä¸€è‡´å¯¹å¾…çš„æƒ…å†µã€‚
2. åœ¨ä¸€ä¸ªä½¿ç”¨é¢å‘å¯¹è±¡è¯­è¨€å¼€å‘çš„ç³»ç»Ÿä¸­éœ€è¦å¤„ç†ä¸€ä¸ªæ ‘å½¢ç»“æ„çš„ã€‚
3. åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­èƒ½åˆ†ç¦»å‡ºå¶å­å’Œå®¹å™¨çš„ï¼Œè€Œä¸”ä»–ä»¬çš„ç±»å‹è¿˜å›ºå®šä¸å˜ï¼Œéœ€è¦å¢åŠ ä¸€äº›æ–°çš„ç±»å‹

# æ€»ç»“

1. ç»„åˆæ¨¡å¼ç”¨äºç»„åˆå¤šä¸ªå¯¹è±¡æ‰€æ„æˆçš„æ ‘å½¢ç»“æ„å±‚æ¬¡ã€‚
2. ç»„åˆæ¨¡å¼åŒ…å«æŠ½è±¡æ„å»ºï¼Œå¶å­æ„å»ºï¼Œå’Œå®¹å™¨æ„å»ºä¸‰ç§è§’è‰²ã€‚
3. ç»„åˆæ¨¡å¼çš„ä¼˜ç‚¹æ˜¯è§£å†³å®¢æˆ·ç«¯ä¸å¥½ç»Ÿä¸€å¯¹å¾…ä¸¤ç§ç±»å‹çš„ç±»ï¼Œç¼ºç‚¹æ˜¯é¢å¯¹ä¸€äº›ç‰¹æ®Šè¦æ±‚æ—¶ä¸å¥½åŠã€‚